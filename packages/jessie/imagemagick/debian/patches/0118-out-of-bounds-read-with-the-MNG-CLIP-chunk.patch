From 1850414f634b78250f9ba7e41b95589e10d83a00 Mon Sep 17 00:00:00 2001
From: Glenn Randers-Pehrson <glennrp@gmail.com>
Date: Mon, 10 Jul 2017 08:23:01 -0400
Subject: [PATCH] out-of-bounds read with the MNG CLIP chunk.

bug-debian: https://bugs.debian.org/870109
origin: https://github.com/ImageMagick/ImageMagick/commit/22e0310345499ffe906c604428f2a3a668942b05

(cherry picked from commit 22e0310345499ffe906c604428f2a3a668942b05)
---
 coders/png.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/coders/png.c b/coders/png.c
index 2a27659f1..f30ae9c2b 100644
--- a/coders/png.c
+++ b/coders/png.c
@@ -5676,6 +5676,8 @@ static Image *ReadOneMNGImage(MngInfo* mng_info, const ImageInfo *image_info,
 
                 for (i=(int) first_object; i <= (int) last_object; i++)
                 {
+                  if ((i < 0) || (i >= MNG_MAX_OBJECTS))
+                    continue;
                   if (mng_info->exists[i] && !mng_info->frozen[i])
                     {
                       MngBox
