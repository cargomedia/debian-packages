From aa40460c061b1ca9524ebd9d2a03dd4f17dd908a Mon Sep 17 00:00:00 2001
From: Cristy <urban-warrior@imagemagick.org>
Date: Sun, 16 Jul 2017 14:43:28 -0400
Subject: [PATCH] CVE-2017-11536 memory leak in jp2 coder

When ImageMagick processes a crafted file in convert, it
can lead to a Memory Leak in the WriteJP2Image() function in
coders/jp2.c.

(include a cast from https://github.com/ImageMagick/ImageMagick/commit/3d5ac8c20846871f1eb3068b65f93da7cd33bfd0)

bug: https://github.com/ImageMagick/ImageMagick/issues/567
bug-debian: https;//bugs.debian.org/869831
origin: https://github.com/ImageMagick/ImageMagick/commit/167e1538ae9818d46c9462a4273082871e35a480
---
 coders/jp2.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/coders/jp2.c b/coders/jp2.c
index 154a0ac55..7503302bf 100644
--- a/coders/jp2.c
+++ b/coders/jp2.c
@@ -924,7 +924,7 @@ static MagickBooleanType WriteJP2Image(const ImageInfo *image_info,Image *image)
       &parameters.subsampling_dx,&parameters.subsampling_dy);
   property=GetImageProperty(image,"comment");
   if (property != (const char *) NULL)
-    parameters.cp_comment=ConstantString(property);
+    parameters.cp_comment=(char *)property;
   channels=3;
   jp2_colorspace=OPJ_CLRSPC_SRGB;
   if (image->colorspace == YUVColorspace)
