From 4912196bfbe9721f66e555009ae63a66375d4453 Mon Sep 17 00:00:00 2001
From: Cristy <urban-warrior@imagemagick.org>
Date: Wed, 26 Apr 2017 16:37:58 -0400
Subject: [PATCH] CVE-2017-8348

The ReadMATImage function in mat.c allows attackers to cause a denial of service (memory leak) via a crafted file.

bug: https://github.com/ImageMagick/ImageMagick/issues/445
origin: https://github.com/ImageMagick/ImageMagick/commit/0c60e6ead120fe2036ceb87662de91d52a4ec4aa
bug-debian: https://bugs.debian.org/862578
---
 coders/mat.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/coders/mat.c b/coders/mat.c
index cc34d1f26..e262e5795 100644
--- a/coders/mat.c
+++ b/coders/mat.c
@@ -1188,7 +1188,6 @@ ImportQuantumPixelsFailed:
   }
       }
     } while(z-- >= 2);
-    quantum_info=DestroyQuantumInfo(quantum_info);
 ExitLoop:
 
 
@@ -1297,6 +1296,7 @@ done_reading:
   }
 
   RelinquishMagickMemory(BImgBuff);
+  quantum_info=DestroyQuantumInfo(quantum_info);
 END_OF_READING:
   clone_info=DestroyImageInfo(clone_info);
   CloseBlob(image);
