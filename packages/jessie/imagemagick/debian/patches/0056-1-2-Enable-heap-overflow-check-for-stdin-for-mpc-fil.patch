From aa269eed49a647cc5259e4195d81008c3077e636 Mon Sep 17 00:00:00 2001
From: Cristy <urban-warrior@imagemagick.org>
Date: Thu, 6 Jul 2017 06:41:49 -0400
Subject: [PATCH] [1/2] Enable heap overflow check for stdin for mpc files

Enabling seekable streams is required to ensure checking the blob size
works when an image is streamed on stdin.

origin: https://github.com/ImageMagick/ImageMagick/commit/b007dd3a048097d8f58949297f5b434612e1e1a3
bug: https://github.com/ImageMagick/ImageMagick/issues/556
bug-debian: https://bugs.debian.org/867896

(cherry picked from commit b007dd3a048097d8f58949297f5b434612e1e1a3)
---
 coders/mpc.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/coders/mpc.c b/coders/mpc.c
index ca479dc43..f49abaaf0 100644
--- a/coders/mpc.c
+++ b/coders/mpc.c
@@ -1006,6 +1006,7 @@ ModuleExport size_t RegisterMPCImage(void)
   entry=SetMagickInfo("CACHE");
   entry->description=ConstantString("Magick Persistent Cache image format");
   entry->module=ConstantString("MPC");
+  entry->seekable_stream=MagickTrue;
   entry->stealth=MagickTrue;
   (void) RegisterMagickInfo(entry);
   entry=SetMagickInfo("MPC");
@@ -1013,6 +1014,7 @@ ModuleExport size_t RegisterMPCImage(void)
   entry->encoder=(EncodeImageHandler *) WriteMPCImage;
   entry->magick=(IsImageFormatHandler *) IsMPC;
   entry->description=ConstantString("Magick Persistent Cache image format");
+  entry->seekable_stream=MagickTrue;
   entry->module=ConstantString("MPC");
   (void) RegisterMagickInfo(entry);
   return(MagickImageCoderSignature);
