From 09653ee225777b46d333a23bd4d9f4688fed36da Mon Sep 17 00:00:00 2001
From: Glenn Randers-Pehrson <glennrp@gmail.com>
Date: Sun, 30 Jul 2017 04:44:36 -0400
Subject: [PATCH] CVE-2017-11750

Fix improper use of NULL in the JNG decoder

Avoid a full pointer dereference

bug-debian: : https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=870478
bug: https://github.com/ImageMagick/ImageMagick/issues/632
origin: https://github.com/ImageMagick/ImageMagick/commit/253d56027765dcbd8d6bc2bbd7d59aa41dab60e7
---
 coders/png.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/coders/png.c b/coders/png.c
index b5df01d93..c028eafb1 100644
--- a/coders/png.c
+++ b/coders/png.c
@@ -4219,7 +4219,8 @@ static Image *ReadOneJNGImage(MngInfo *mng_info,
       {
         if (length > GetBlobSize(image))
           {
-            DestroyJNG(NULL,&color_image,&color_image_info,NULL,NULL);
+            DestroyJNG(NULL,&color_image,&color_image_info,
+              &alpha_image,&alpha_image_info);
             ThrowReaderException(CorruptImageError,
               "InsufficientImageDataInFile");
           }
