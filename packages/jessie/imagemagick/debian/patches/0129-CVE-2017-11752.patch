From 0cf144626499c18fed5151c844d6f498c5f4f510 Mon Sep 17 00:00:00 2001
From: Cristy <urban-warrior@imagemagick.org>
Date: Sat, 29 Jul 2017 08:45:42 -0400
Subject: [PATCH] CVE-2017-11752

The ReadMAGICKImage function in coders/magick.c in ImageMagick 7.0.6-4
allows remote attackers to cause a denial of service (memory leak) via
a crafted file.

bug-debian: https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=870481
bug: https://github.com/ImageMagick/ImageMagick/issues/628
origin: https://github.com/ImageMagick/ImageMagick/commit/9eccfd52199616da66c93b6d627d4d4126f5a5f0
---
 coders/magick.c | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/coders/magick.c b/coders/magick.c
index eb5c62907..e637cd30c 100644
--- a/coders/magick.c
+++ b/coders/magick.c
@@ -13067,7 +13067,10 @@ static Image *ReadMAGICKImage(const ImageInfo *image_info,
         break;
       }
   if (blob == (const void *) NULL)
-    ThrowReaderException(OptionError,"UnrecognizedImageFormat");
+    {
+      blob_info=DestroyImageInfo(blob_info);
+      ThrowReaderException(OptionError,"UnrecognizedImageFormat");
+    }
   image=BlobToImage(blob_info,blob,extent,exception);
   blob_info=DestroyImageInfo(blob_info);
   if (image == (Image *) NULL)
