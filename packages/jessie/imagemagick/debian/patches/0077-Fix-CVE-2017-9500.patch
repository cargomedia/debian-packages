From 4badc28883702f8010c0a2a02deb4ab98630cc3b Mon Sep 17 00:00:00 2001
From: Cristy <urban-warrior@imagemagick.org>
Date: Tue, 23 May 2017 19:08:23 -0400
Subject: [PATCH] Fix CVE-2017-9500:

An assertion failure was found in the function ResetImageProfileIterator, which allows attackers to cause a denial of service via a crafted file.

debian-bug: https://bugs.debian.org/867778
bug: https://github.com/ImageMagick/ImageMagick/issues/500
origin: https://github.com/ImageMagick/ImageMagick/commit/837085e7725f6eb591eb019e299c1ddcf34b9a79
---
 coders/miff.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/coders/miff.c b/coders/miff.c
index 8149fdde9..6929bfc2b 100644
--- a/coders/miff.c
+++ b/coders/miff.c
@@ -1089,6 +1089,7 @@ static Image *ReadMIFFImage(const ImageInfo *image_info,
       {
         if (image->previous == (Image *) NULL)
           ThrowReaderException(CorruptImageError,"ImproperImageHeader");
+        DeleteImageFromList(&image);
         (void) ThrowMagickException(&image->exception,GetMagickModule(),
           CorruptImageError,"ImproperImageHeader","`%s'",image->filename);
         break;
