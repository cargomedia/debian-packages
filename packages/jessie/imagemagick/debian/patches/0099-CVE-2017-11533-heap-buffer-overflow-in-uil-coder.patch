From afc1d64d350734b772ed815b4bbd50c2f29c1b44 Mon Sep 17 00:00:00 2001
From: Cristy <urban-warrior@imagemagick.org>
Date: Sun, 16 Jul 2017 11:00:52 -0400
Subject: [PATCH] CVE-2017-11533: heap buffer overflow in uil coder

When ImageMagick processes a crafted file in convert, it can
lead to a heap-based buffer over-read in the WriteUILImage() function
in coders/uil.c.

bug-debian: https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=869834.
bug: https://github.com/ImageMagick/ImageMagick/issues/562
origin: https://github.com/ImageMagick/ImageMagick/commit/ed1fd69231ab21dc540167c63bc3b0fa3282ec59
(cherry picked from commit ed1fd69231ab21dc540167c63bc3b0fa3282ec59)
---
 coders/uil.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/coders/uil.c b/coders/uil.c
index a7e337321..78fa0d805 100644
--- a/coders/uil.c
+++ b/coders/uil.c
@@ -259,6 +259,8 @@ static MagickBooleanType WriteUILImage(const ImageInfo *image_info,Image *image)
             }
           }
         }
+      if (i != 0)
+        i--;
       (void) SetImageType(image,PaletteType);
       colors=image->colors;
       if (transparent != MagickFalse)
